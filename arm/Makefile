pact.bin: pact.elf
	arm-none-eabi-objcopy -S -O binary $< $@
	arm-none-eabi-size $<

pact.elf: pact.o
	arm-none-eabi-ld -Ttext 0x08000000 -o $@ $<

%.o: %.S Makefile
	arm-none-eabi-gcc -ffreestanding -nostdlib -g -mthumb -mcpu=cortex-m0 -o $@ $<

dump: pact.elf
	arm-none-eabi-objdump --demangle --disassemble $<

debug: pact.bin
	# Assume you're using a STM32 board.
	st-flash write pact.bin 0x08000000
	# Spawn a debug server in a separate window
	st-util & PID=$$!; arm-none-eabi-gdb -x gdbinit pact.elf; kill $$PID

clean:
	rm -f *.bin *.elf *.o
